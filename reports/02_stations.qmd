---
title: "Station summary"
format:
  html:
    code-fold: true
editor: visual
output-dir: "docs"
---

```{r}
#| label: setup
#| include: false

library(targets)
library(tidyverse)

tar_load(c("zoop_sf", "ant_sf"), store = here::here("_targets"))
source(here::here("R", "sp.R"))
source(here::here("R", "zoop.R"))
```

## Station maps

Sampling stations across survey years, color-coded by time-of-day. Grey circles indicate 10k, 15k, and 20k buffers.

```{r}
#| label: station_maps

zoop_buffers_10k <- sf::st_buffer(zoop_sf, 5e3)
zoop_buffers_15k <- sf::st_buffer(zoop_sf, 10e3)
zoop_buffers_20k <- sf::st_buffer(zoop_sf, 20e3)

map_lim <- sf::st_bbox(zoop_sf) %>% 
  project_bbox() %>% 
  expand_bbox(factor = 1.2)

ant_basemap(map_lim) +
  geom_sf(aes(color = time.of.day), zoop_sf, size = 0.2) +
  geom_sf(data = zoop_buffers_10k, color = "lightgrey", fill = NA) +
  geom_sf(data = zoop_buffers_15k, color = "lightgrey", fill = NA) +
  geom_sf(data = zoop_buffers_20k, color = "lightgrey", fill = NA) +
  facet_wrap(~ Year) +
  scale_x_continuous(breaks = c(-60, -55)) +
  scale_y_continuous(breaks = c(-63, -62, -61, -60)) +
  scale_color_manual(values = tod_pal()) +
  guides(color = guide_legend(override.aes = list(size = 2))) +
  coord_ant(map_lim) +
  theme(legend.position = "bottom",
        legend.title = element_blank())
```

## Zooplankton community/physics maps

```{r}
#| label: zoop_physics_maps

zoop_physics_vars <- c("Winter Cluster factor",
                       "Net.ice.type",
                       "Net.ice.percent",
                       "zuml_m",
                       "avg.Dens.Diff",
                       "avg.salinity",
                       "avg.temp",
                       "Water.Zone",
                       "Integ.chla.zuml",
                       "Integ.phae.zuml",
                       "Integ.chla.100m",
                       "Integ.phae.100m")

station_map <- function(var) {
  ant_basemap(map_lim) +
    geom_sf(aes(color = .data[[var]]), zoop_sf, size = 2, shape = 15) +
    facet_wrap(~ Year) +
    scale_x_continuous(breaks = c(-60, -55)) +
    scale_y_continuous(breaks = c(-63, -62, -61, -60)) +
    coord_ant(map_lim) +
    theme(legend.position = "bottom")
}

walk(zoop_physics_vars, compose(print, station_map))

```
